{"ast":null,"code":"import { base64Decode, base64Encode } from '../encoding/base64';\nimport { md5 } from '../encoding/md5';\nimport { LicenseStatus } from '../utils/licenseStatus';\nimport { LICENSE_SCOPES } from '../utils/licenseScope';\nimport { LICENSING_MODELS } from '../utils/licensingModel';\nconst getDefaultReleaseDate = () => {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  return today;\n};\nexport function generateReleaseInfo() {\n  let releaseDate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getDefaultReleaseDate();\n  return base64Encode(releaseDate.getTime().toString());\n}\nconst expiryReg = /^.*EXPIRY=([0-9]+),.*$/;\n\n/**\n * Format: ORDER:${orderNumber},EXPIRY=${expiryTimestamp},KEYVERSION=1\n */\nconst decodeLicenseVersion1 = license => {\n  let expiryTimestamp;\n  try {\n    expiryTimestamp = parseInt(license.match(expiryReg)[1], 10);\n    if (!expiryTimestamp || Number.isNaN(expiryTimestamp)) {\n      expiryTimestamp = null;\n    }\n  } catch (err) {\n    expiryTimestamp = null;\n  }\n  return {\n    scope: 'pro',\n    licensingModel: 'perpetual',\n    expiryTimestamp\n  };\n};\n/**\n * Format: O=${orderNumber},E=${expiryTimestamp},S=${scope},LM=${licensingModel},KV=2`;\n */\n\nconst decodeLicenseVersion2 = license => {\n  const licenseInfo = {\n    scope: null,\n    licensingModel: null,\n    expiryTimestamp: null\n  };\n  license.split(',').map(token => token.split('=')).filter(el => el.length === 2).forEach(_ref => {\n    let [key, value] = _ref;\n    if (key === 'S') {\n      licenseInfo.scope = value;\n    }\n    if (key === 'LM') {\n      licenseInfo.licensingModel = value;\n    }\n    if (key === 'E') {\n      const expiryTimestamp = parseInt(value, 10);\n      if (expiryTimestamp && !Number.isNaN(expiryTimestamp)) {\n        licenseInfo.expiryTimestamp = expiryTimestamp;\n      }\n    }\n  });\n  return licenseInfo;\n};\n/**\n * Decode the license based on its key version and return a version-agnostic `MuiLicense` object.\n */\n\nconst decodeLicense = encodedLicense => {\n  const license = base64Decode(encodedLicense);\n  if (license.includes('KEYVERSION=1')) {\n    return decodeLicenseVersion1(license);\n  }\n  if (license.includes('KV=2')) {\n    return decodeLicenseVersion2(license);\n  }\n  return null;\n};\nexport function verifyLicense(_ref2) {\n  let {\n    releaseInfo,\n    licenseKey,\n    acceptedScopes,\n    isProduction\n  } = _ref2;\n  if (!releaseInfo) {\n    throw new Error('MUI: The release information is missing. Not able to validate license.');\n  }\n  if (!licenseKey) {\n    return LicenseStatus.NotFound;\n  }\n  const hash = licenseKey.substr(0, 32);\n  const encoded = licenseKey.substr(32);\n  if (hash !== md5(encoded)) {\n    return LicenseStatus.Invalid;\n  }\n  const license = decodeLicense(encoded);\n  if (license == null) {\n    console.error('Error checking license. Key version not found!');\n    return LicenseStatus.Invalid;\n  }\n  if (license.licensingModel == null || !LICENSING_MODELS.includes(license.licensingModel)) {\n    console.error('Error checking license. Sales model not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n  if (license.expiryTimestamp == null) {\n    console.error('Error checking license. Expiry timestamp not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n  if (license.licensingModel === 'perpetual' || isProduction) {\n    const pkgTimestamp = parseInt(base64Decode(releaseInfo), 10);\n    if (Number.isNaN(pkgTimestamp)) {\n      throw new Error('MUI: The release information is invalid. Not able to validate license.');\n    }\n    if (license.expiryTimestamp < pkgTimestamp) {\n      return LicenseStatus.Expired;\n    }\n  } else if (license.licensingModel === 'subscription') {\n    if (license.expiryTimestamp < new Date().getTime()) {\n      return LicenseStatus.Expired;\n    }\n  }\n  if (license.scope == null || !LICENSE_SCOPES.includes(license.scope)) {\n    console.error('Error checking license. scope not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n  if (!acceptedScopes.includes(license.scope)) {\n    return LicenseStatus.OutOfScope;\n  }\n  return LicenseStatus.Valid;\n}","map":{"version":3,"names":["base64Decode","base64Encode","md5","LicenseStatus","LICENSE_SCOPES","LICENSING_MODELS","getDefaultReleaseDate","today","Date","setHours","generateReleaseInfo","releaseDate","getTime","toString","expiryReg","decodeLicenseVersion1","license","expiryTimestamp","parseInt","match","Number","isNaN","err","scope","licensingModel","decodeLicenseVersion2","licenseInfo","split","map","token","filter","el","length","forEach","key","value","decodeLicense","encodedLicense","includes","verifyLicense","releaseInfo","licenseKey","acceptedScopes","isProduction","Error","NotFound","hash","substr","encoded","Invalid","console","error","pkgTimestamp","Expired","OutOfScope","Valid"],"sources":["/Users/chiaqiyang/Desktop/DoubleC-main/client/node_modules/@mui/x-license-pro/verifyLicense/verifyLicense.js"],"sourcesContent":["import { base64Decode, base64Encode } from '../encoding/base64';\nimport { md5 } from '../encoding/md5';\nimport { LicenseStatus } from '../utils/licenseStatus';\nimport { LICENSE_SCOPES } from '../utils/licenseScope';\nimport { LICENSING_MODELS } from '../utils/licensingModel';\n\nconst getDefaultReleaseDate = () => {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  return today;\n};\n\nexport function generateReleaseInfo(releaseDate = getDefaultReleaseDate()) {\n  return base64Encode(releaseDate.getTime().toString());\n}\nconst expiryReg = /^.*EXPIRY=([0-9]+),.*$/;\n\n/**\n * Format: ORDER:${orderNumber},EXPIRY=${expiryTimestamp},KEYVERSION=1\n */\nconst decodeLicenseVersion1 = license => {\n  let expiryTimestamp;\n\n  try {\n    expiryTimestamp = parseInt(license.match(expiryReg)[1], 10);\n\n    if (!expiryTimestamp || Number.isNaN(expiryTimestamp)) {\n      expiryTimestamp = null;\n    }\n  } catch (err) {\n    expiryTimestamp = null;\n  }\n\n  return {\n    scope: 'pro',\n    licensingModel: 'perpetual',\n    expiryTimestamp\n  };\n};\n/**\n * Format: O=${orderNumber},E=${expiryTimestamp},S=${scope},LM=${licensingModel},KV=2`;\n */\n\n\nconst decodeLicenseVersion2 = license => {\n  const licenseInfo = {\n    scope: null,\n    licensingModel: null,\n    expiryTimestamp: null\n  };\n  license.split(',').map(token => token.split('=')).filter(el => el.length === 2).forEach(([key, value]) => {\n    if (key === 'S') {\n      licenseInfo.scope = value;\n    }\n\n    if (key === 'LM') {\n      licenseInfo.licensingModel = value;\n    }\n\n    if (key === 'E') {\n      const expiryTimestamp = parseInt(value, 10);\n\n      if (expiryTimestamp && !Number.isNaN(expiryTimestamp)) {\n        licenseInfo.expiryTimestamp = expiryTimestamp;\n      }\n    }\n  });\n  return licenseInfo;\n};\n/**\n * Decode the license based on its key version and return a version-agnostic `MuiLicense` object.\n */\n\n\nconst decodeLicense = encodedLicense => {\n  const license = base64Decode(encodedLicense);\n\n  if (license.includes('KEYVERSION=1')) {\n    return decodeLicenseVersion1(license);\n  }\n\n  if (license.includes('KV=2')) {\n    return decodeLicenseVersion2(license);\n  }\n\n  return null;\n};\n\nexport function verifyLicense({\n  releaseInfo,\n  licenseKey,\n  acceptedScopes,\n  isProduction\n}) {\n  if (!releaseInfo) {\n    throw new Error('MUI: The release information is missing. Not able to validate license.');\n  }\n\n  if (!licenseKey) {\n    return LicenseStatus.NotFound;\n  }\n\n  const hash = licenseKey.substr(0, 32);\n  const encoded = licenseKey.substr(32);\n\n  if (hash !== md5(encoded)) {\n    return LicenseStatus.Invalid;\n  }\n\n  const license = decodeLicense(encoded);\n\n  if (license == null) {\n    console.error('Error checking license. Key version not found!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.licensingModel == null || !LICENSING_MODELS.includes(license.licensingModel)) {\n    console.error('Error checking license. Sales model not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.expiryTimestamp == null) {\n    console.error('Error checking license. Expiry timestamp not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.licensingModel === 'perpetual' || isProduction) {\n    const pkgTimestamp = parseInt(base64Decode(releaseInfo), 10);\n\n    if (Number.isNaN(pkgTimestamp)) {\n      throw new Error('MUI: The release information is invalid. Not able to validate license.');\n    }\n\n    if (license.expiryTimestamp < pkgTimestamp) {\n      return LicenseStatus.Expired;\n    }\n  } else if (license.licensingModel === 'subscription') {\n    if (license.expiryTimestamp < new Date().getTime()) {\n      return LicenseStatus.Expired;\n    }\n  }\n\n  if (license.scope == null || !LICENSE_SCOPES.includes(license.scope)) {\n    console.error('Error checking license. scope not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (!acceptedScopes.includes(license.scope)) {\n    return LicenseStatus.OutOfScope;\n  }\n\n  return LicenseStatus.Valid;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}